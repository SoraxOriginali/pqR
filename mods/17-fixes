Various changes/fixes.

Some changes for compatibility with various packages, allowing
more access to internals.

Fixes the following bug:

  f <- function (a) 
  { 
    x <- a
  
    function () { b <- a; b[2]<-1000; a+b  }
  }
  
  g <- f(c(7,8,9))
  
  save.image("tmpimage")
  load("tmpimage")
  
  print(g())
  
where the result printed was 14 2000 18 rather than 14 1008 18.

Fixes bug in prod with integer vector containing NA, eg prod(NA).

Cleaned up code in R_AllocStringBuffer, avoiding potential segfault.
